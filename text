$('#mySelect').select2({
    placeholder: "Search and Learn...",
    ajax: {
        url: 'https://staticapis.pragament.com/online_courses/freecodecamp-html.json',
        dataType: 'json',
        delay: 250,
        processResults: function (data, params) {
            let searchTerm = params.term ? params.term.toLowerCase() : ''; // Get search term
            let results = [];
            if (data && data.chapters && Array.isArray(data.chapters)) {
                data.chapters.forEach(chapter => {
                    if (chapter && chapter.name) {
                        let chapterData = {
                            id: chapter.name,
                            text: chapter.name,
                            children: []
                        };

                        if (chapter.topics && Array.isArray(chapter.topics)) {
                            chapter.topics.forEach(topic => {
                                if (topic && topic.title && topic.title.toLowerCase().includes(searchTerm)) {
                                    chapterData.children.push({
                                        id: chapter.name + ' - ' + topic.title,
                                        text: topic.title
                                    });
                                }
                            });
                        }

                        if (chapter.name.toLowerCase().includes(searchTerm) || chapterData.children.length > 0) {
                            results.push(chapterData);
                        }
                    }
                });
            }

            return {
                results: results
            };
        },
        cache: true
    },
    minimumInputLength: 0,
    templateResult: function (data) {
        if (data.children) {
            return $('<span><b>' + data.text + '</b></span>');
        }
        return data.text;
    }
});

$(document).ready(function() {
    $('#mySelect').on('select2:select', function (e) {
        var selectedText = e.params.data.text;
        $('.message-box').text('' + selectedText);
    });
});