<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Playground</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/theme/monokai.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            flex-direction: column;
            background-color: #1a1a2e;
            color: #f8f8f2;
        }

        .toolbar {
            display: flex;
            flex-direction: column;
            background: #22223b;
            padding: 15px;
            gap: 12px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        .toolbar button {
            background: linear-gradient(135deg, #4a148c, #6a1b9a);
            color: #fff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            padding: 12px 20px;
            font-size: 18px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 500;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
            border: 1px solid #512da8;
        }

        .toolbar button:hover {
            background: linear-gradient(135deg, #5e35b1, #7e57c2);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.5);
        }

        .toolbar button:active {
            background: linear-gradient(135deg, #4a148c, #6a1b9a);
            transform: translateY(0) scale(0.95);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .file-explorer {
            width: 200px;
            background: #22223b;
            color: #fff;
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid #444;
        }

        .file-explorer ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .file-explorer li {
            padding: 12px 16px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .file-explorer li.hover:hover {
            background: linear-gradient(135deg, #4a148c, #6a1b9a);
            transform: translateX(4px);
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }

        .file-explorer img {
            width: 80%;
            height: auto;
            border-radius: 6px;
            margin-top: 10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .CodeMirror {
            border-bottom: 1px solid #444;
            font-family: 'Fira Mono', monospace;
            font-size: 16px;
            background: #1a1a2e;
            color: #f8f8f2;
        }

        .preview-container {
            flex: 1;
            display: flex;
        }

        .preview {
            flex: 1;
            border-left: 1px solid #444;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
            background-color: #fff;
        }

        .hidden {
            display: none !important;
        }

        .divider-text {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
            color: #6c757d;
        }

        .divider-text::before,
        .divider-text::after {
            content: "";
            flex: 1;
            border-bottom: 1px solid #6c757d;
            margin: 0 15px;
        }

        .help-button {
            visibility: hidden;
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: #ff6f61;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 30px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: background-color 0.3s ease;
        }

        .help-button:hover {
            background-color: #e53935;
        }

        .help-button:active {
            background-color: #ff6f61;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .chat-window {
            position: fixed;
            bottom: 90px;
            right: 30px;
            width: 350px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            z-index: 1000;
        }

        .chat-header {
            background: linear-gradient(135deg, #4a148c, #6a1b9a);
            color: white;
            padding: 15px;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            font-weight: bold;
            font-size: 20px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }

        .chat-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            max-height: 300px;
            background-color: #f5f5f5;
            border-bottom: 1px solid #ccc;
        }

        .chat-footer {
            display: flex;
            padding: 10px;
        }

        .chat-footer input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-right: 10px;
            font-size: 16px;
        }

        .chat-footer button {
            background: linear-gradient(135deg, #4a148c, #6a1b9a);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 16px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .chat-footer button:hover {
            background: linear-gradient(135deg, #5e35b1, #7e57c2);
            transform: scale(1.05);
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
        }

        .chat-footer button:active {
            background: linear-gradient(135deg, #4a148c, #6a1b9a);
            transform: scale(0.95);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .message.user {
            align-items: flex-end;
        }

        .message.bot {
            align-items: flex-start;
        }

        .message p {
            display: inline-block;
            padding: 12px;
            border-radius: 18px;
            max-width: 80%;
            font-size: 16px;
            line-height: 1.4;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .message.user p {
            background: linear-gradient(135deg, #4a148c, #6a1b9a);
            color: white;
            border-bottom-right-radius: 4px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }

        .message.bot p {
            background: #e0e0e0;
            color: #333;
            border-bottom-left-radius: 4px;
        }

        @media (max-width: 600px) {
            .toolbar {
                gap: 8px;
                padding: 10px;
            }

            .toolbar button {
                padding: 10px 16px;
                font-size: 14px;
            }

            .main-container {
                flex-direction: column;
            }

            .file-explorer {
                width: 100%;
                height: 180px;
                border-right: none;
                border-bottom: 1px solid #444;
            }

            .editor-container {
                height: 50vh;
            }

            .preview-container {
                height: 30vh;
            }

            .help-button {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 24px;
            }

            .chat-window {
                width: 95%;
                right: 2.5%;
                bottom: 80px;
            }

            .chat-header {
                font-size: 18px;
                padding: 12px;
            }

            .chat-footer input {
                padding: 8px;
                font-size: 14px;
            }

            .chat-footer button {
                padding: 8px 14px;
                font-size: 14px;
            }

            .message p {
                font-size: 14px;
                padding: 10px;
            }
        }

        .toolbar button:disabled {
            pointer-events: none;
            opacity: 0.6;
            cursor: not-allowed;
            background: #9e9e9e;
            color: #fff;
            text-shadow: none;
            box-shadow: none;
            border: none;
        }

        .toolbar button:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: flex-start;
        }

        .divider {
            width: 2px;
            height: 30px;
            background-color: #6c757d;
            margin: 0 15px;
        }

        .preview-right {
            flex-direction: row;
        }

        .preview-bottom {
            flex-direction: column;
        }

        .preview-bottom .preview {
            border-left: none;
            border-top: 1px solid #444;
        }

        #special-char-buttons {
            flex-basis: 100%;
            display: none;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: flex-start;
        }

        #special-char-buttons button {
            padding: 10px 14px;
            font-size: 14px;
            background: linear-gradient(135deg, #34495e, #4267b2);
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            font-weight: 500;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
            border: 1px solid #2c3e50;
        }

        #special-char-buttons button:hover {
            background: linear-gradient(135deg, #2c3e50, #3b5998);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
        }

        #special-char-buttons button:active {
            background: linear-gradient(135deg, #34495e, #4267b2);
            transform: translateY(0) scale(0.95);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        #capsWarning {
            display: none;
            color: #ffeb3b;
            font-weight: bold;
            animation: blink 1s infinite alternate;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 15px;
            background-color: #d32f2f;
            border-radius: 5px;
            z-index: 1000;
        }

        @keyframes blink {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <div class="toolbar">
        <div class="button-group">
            <button onclick="togglePreviewLayout()" hidden id="preview-toggle-button" title="Toggle Preview Layout">
                <i class="fas fa-eye-slash"></i> <span class="button-text">Preview</span>
            </button>
            <button id="undo-button" onclick="undo()" disabled title="Undo the last action">
                <i class="fas fa-undo"></i> <span class="button-text">Undo</span>
            </button>
            <button id="redo-button" onclick="redo()" disabled title="Redo the last undone action">
                <i class="fas fa-redo"></i> <span class="button-text">Redo</span>
            </button>
            <button onclick="zoomIn()" title="Zoom in">
                <i class="fas fa-search-plus"></i> <span class="button-text">Zoom In</span>
            </button>
            <button onclick="zoomOut()" title="Zoom out">
                <i class="fas fa-search-minus"></i> <span class="button-text">Zoom Out</span>
            </button>
            <button onclick="insertTemplate()" title="Insert Template">
                <i class="fas fa-file-code"></i> <span class="button-text">Template</span>
            </button>
            <button onclick="selectAll()" title="Select All">
                <i class="fas fa-file-alt"></i> <span class="button-text">Select All</span>
            </button>
            <button onclick="copyText()" title="Copy">
                <i class="fas fa-copy"></i> <span class="button-text">Copy</span>
            </button>
            <button onclick="pasteText()" title="Paste">
                <i class="fas fa-paste"></i> <span class="button-text">Paste</span>
            </button>
            <button onclick="clearEditor()" title="Clear Editor">
                <i class="fas fa-trash"></i> <span class="button-text">Clear</span>
            </button>
            <button onclick="toggleAutocomplete()" id="autocomplete-button" title="Toggle Autocomplete">
                <i class="fas fa-lightbulb"></i> <span class="button-text">Autocomplete: ‚ùåOff</span>
            </button>
            <button onclick="prettifyCode()" title="Prettify Code">
                <i class="fas fa-code"></i> <span class="button-text">Prettify</span>
            </button>
            <button onclick="saveFile()" title="Save File">
                <i class="fas fa-save"></i> <span class="button-text">Save</span>
            </button>
            <button onclick="createNewFile()" title="Create New File">
                <i class="fas fa-plus-circle"></i> <span class="button-text">New File</span>
            </button>
            <button onclick="viewAutosavedFiles()" title="View Saved Files">
                <i class="fas fa-eye"></i> <span class="button-text">View Saved</span>
            </button>
            <button onclick="toggleSpecialChars()" title="Show/Hide Special Characters">
                <i class="fas fa-keyboard"></i> <span class="button-text">Special Chars</span>
            </button>
            <p id="capsWarning">‚ö†Ô∏è Caps Lock is ON!</p>
        </div>

        <div class="button-group" id="special-char-buttons">
            <button onclick="insertLoremIpsum('<')" title="Less-than sign: <">&lt;</button>
            <button onclick="insertLoremIpsum('>')" title="Greater-than sign: >">&gt;</button>
            <button onclick="insertLoremIpsum('/')" title="Forward slash: /">/</button>
            <button onclick="insertLoremIpsum('&quot;')" title="Double quote: &quot;">"</button>
            <button onclick="insertLoremIpsum('\'')" title="Single quote: '">'</button>
            <button onclick="insertLoremIpsum('=')" title="Equals sign: =">=</button>
            <button onclick="insertLoremIpsum('&')" title="Ampersand: &">&amp;</button>
            <button onclick="insertLoremIpsum(';')" title="Semicolon: ;">;</button>
            <button onclick="insertLoremIpsum('#')" title="Hash/Pound sign: #">#</button>
            <button onclick="insertLoremIpsum('.')" title="Period/Dot: .">.</button>
            <button onclick="insertLoremIpsum(':')" title="Colon: :">:</button>
            <button onclick="insertLoremIpsum('-')" title="Hyphen: -">-</button>
            <button onclick="insertLoremIpsum('_')" title="Underscore: _">_</button>
            <button onclick="insertLoremIpsum('{')" title="Opening curly brace: {">{</button>
            <button onclick="insertLoremIpsum('}')" title="Closing curly brace: }">}</button>
            <button onclick="insertLoremIpsum('[')" title="Opening square bracket: [">[</button>
            <button onclick="insertLoremIpsum(']')" title="Closing square bracket: ]">]</button>
            <button onclick="insertLoremIpsum('(')" title="Opening parenthesis: (">(</button>
            <button onclick="insertLoremIpsum(')')" title="Closing parenthesis: )">)</button>
            <button onclick="insertLoremIpsum('!')" title="Exclamation mark: !">!</button>
            <button onclick="insertLoremIpsum('*')" title="Asterisk: *">*</button>
            <button onclick="insertLoremIpsum('|')" title="Vertical bar/Pipe: |">|</button>
            <button onclick="insertLoremIpsum('?')" title="Question mark: ?">?</button>
            <button onclick="insertLoremIpsum('@')" title="At symbol: @">@</button>
            <button onclick="insertLoremIpsum('~')" title="Tilde: ~">~</button>
            <button onclick="insertLoremIpsum('&copy;')" title="Copyright symbol: &copy;">&copy;</button>
            <button onclick="insertLoremIpsum('&reg;')" title="Registered trademark symbol: &reg;">&reg;</button>
            <button onclick="insertLoremIpsum('‚Çπ')" title="Indian Rupee symbol: ‚Çπ">‚Çπ</button>
            <button onclick="insertLoremIpsum('$')" title="Dollar sign: $">$</button>
        </div>
    </div>

    <div class="main-container preview-right" id="main-container">
        <div class="file-explorer">
            <ul>
                <li class="hover" onclick="toggleFile('html')">
                    <i class="fab fa-html5"></i> <span class="file-name">index.html</span>
                </li>
                <li class="hover" onclick="toggleFile('css')">
                    <i class="fab fa-css3-alt"></i> <span class="file-name">style.css</span>
                </li>
                <li class="hover" onclick="toggleFile('js')">
                    <i class="fab fa-js"></i> <span class="file-name">script.js</span>
                </li>
            </ul>
            <div class="divider-text">Text</div>

            <strong></strong>
            <ul>
                <li class="hover" onclick="insertLoremIpsum('Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.')">
                    <i class="fas fa-file-word"></i> <span class="file-name">Sample Text</span>
                </li>
            </ul>
            <div class="divider-text">Images</div>
            <strong></strong>
            <ul>
                <li class="hover" onclick="insertImagePath('./images/sample1.jpg')">
                    <i class="fas fa-image"></i> <span class="file-name">sample1.jpg</span>
                    <img src="images/sample1.jpg" alt="Sample 1">
                </li>
                <li class="hover" onclick="insertImagePath('./images/sample2.jpg')">
                    <i class="fas fa-image"></i> <span class="file-name">sample2.jpg</span>
                    <img src="images/sample2.jpg" alt="Sample 2">
                </li>
                <li class="hover" onclick="insertImagePath('./images/sample3.jpg')">
                    <i class="fas fa-image"></i> <span class="file-name">sample3.jpg</span>
                    <img src="images/sample3.jpg" alt="Sample 3">
                </li>
            </ul>
        </div>
        <div class="editor-container">
            <textarea id="html-code" class="hidden">
</textarea>
            <textarea id="css-code" class="hidden">
/* Add your CSS here */
</textarea>
            <textarea id="js-code" class="hidden">
// Add your JavaScript here
</textarea>
            <div class="preview-container">
                <iframe id="preview"></iframe>
            </div>
        </div>
    </div>
    <button class="help-button" onclick="toggleChat()">?</button>

    <div class="chat-window">
        <div class="chat-header">Help Chat</div>
        <div class="chat-body" id="chat-body">
            <div class="message bot">
                <p>Hello! How can I help you today?</p>
            </div>
            <div class="action-buttons">
                <button onclick="showFAQs()">View FAQs</button>
                <button onclick="showCustomMessageInput()">Send Custom Message</button>
            </div>
        </div>
        <div class="chat-footer">
            <input type="text" id="chat-input" placeholder="Type your message...">
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/addon/hint/xml-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/addon/hint/javascript-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/addon/hint/html-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/addon/hint/css-hint.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.63.0/addon/hint/show-hint.min.css">
    <script>
        // Default sample code
        const defaultHTML = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Playground</title>
    <style>
        /* Add your internal CSS here */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            text-align: center;
            padding: 50px;
        }
        h1 {
            color: #333;
        }
    </style>
</head>
<body>
    <h1>Hello, World!</h1>
    <p>Welcome to the Code Playground.</p>
    <script>
        // Add your internal JavaScript here
        console.log('Hello from the script!');
    <\/script>
</body>
</html>`;

        const defaultCSS = `/* Add your CSS here */
body {
    background-color: #f0f0f0;
    font-family: Arial, sans-serif;
}

h1 {
    color: #333;
    text-align: center;
}

p {
    color: #666;
}`;

        const defaultJS = `// Add your JavaScript here
console.log('Hello from script.js!');

document.querySelector('h1').addEventListener('click', () => {
    alert('You clicked the heading!');
});`;

        // Initialize CodeMirror editors with default content
        const htmlEditor = CodeMirror.fromTextArea(document.getElementById('html-code'), {
            mode: 'htmlmixed',
            theme: 'monokai',
            lineNumbers: true,
            autoCloseTags: true,
            value: defaultHTML,
            extraKeys: { "Ctrl-Space": "autocomplete" },
        });
        const cssEditor = CodeMirror.fromTextArea(document.getElementById('css-code'), {
            mode: 'css',
            theme: 'monokai',
            lineNumbers: true,
            value: defaultCSS,
            extraKeys: { "Ctrl-Space": "autocomplete" },
        });
        const jsEditor = CodeMirror.fromTextArea(document.getElementById('js-code'), {
            mode: 'javascript',
            theme: 'monokai',
            lineNumbers: true,
            value: defaultJS,
            extraKeys: { "Ctrl-Space": "autocomplete" },
        });

        // Automatically show hints while typing
        cssEditor.on("inputRead", function (cm, event) {
            if (!cm.state.completionActive) {  // Prevent multiple popups
                CodeMirror.commands.autocomplete(cm, null, { completeSingle: false });
            }
        });

        // Automatically show hints while typing
        htmlEditor.on("inputRead", function (cm, event) {
            const autocompleteButton = document.getElementById('autocomplete-button');
            const isOn = autocompleteButton.textContent.includes('On');
            if (isOn && !cm.state.completionActive) {  // Prevent multiple popups
                CodeMirror.commands.autocomplete(cm, null, { completeSingle: false });
            }
        });

        // Automatically show hints while typing
        jsEditor.on("inputRead", function (cm, event) {
            if (!cm.state.completionActive) {  // Prevent multiple popups
                CodeMirror.commands.autocomplete(cm, null, { completeSingle: false });
            }
        });

        // Function to update the preview
        function updatePreview() {
            const html = htmlEditor.getValue();
            const css = `<style>${cssEditor.getValue()}</style>`;
            const js = `<script>
                try {
                    ${jsEditor.getValue()}
                } catch (error) {
                    console.error(error);
                }
            <\/script>`;
            const preview = document.getElementById('preview');
            preview.srcdoc = html + css + js;
        }

        // Update preview on editor change
        htmlEditor.on('change', updatePreview);
        cssEditor.on('change', updatePreview);
        jsEditor.on('change', updatePreview);

        // Function to toggle files
        function toggleFile(type) {
            const htmlEditorElement = htmlEditor.getWrapperElement();
            const cssEditorElement = cssEditor.getWrapperElement();
            const jsEditorElement = jsEditor.getWrapperElement();

            htmlEditorElement.classList.add('hidden');
            cssEditorElement.classList.add('hidden');
            jsEditorElement.classList.add('hidden');

            if (type === 'html') {
                htmlEditorElement.classList.remove('hidden');
            } else if (type === 'css') {
                cssEditorElement.classList.remove('hidden');
            } else if (type === 'js') {
                jsEditorElement.classList.remove('hidden');
            }
        }

        // Function to insert image path at cursor position
        function insertImagePath(imagePath) {
            const activeEditor = getActiveEditor();
            if (activeEditor) {
                const cursor = activeEditor.getCursor();
                activeEditor.replaceRange(imagePath, cursor);
                activeEditor.focus(); // Focus back on the editor
            }
        }

        // Function to insert Lorem Ipsum at cursor position
        function insertTemplate() {
            const activeEditor = getActiveEditor();
            if (activeEditor) {
                const wrappedText = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello World</title>
</head>
<body>
    <h1>Hello, World!</h1>
</body>
</html>`;
                const cursor = activeEditor.getCursor();
                clearEditor();
                activeEditor.replaceRange(wrappedText, cursor);
                activeEditor.focus(); // Focus back on the editor
            }
        }

        // Function to insert Lorem Ipsum at cursor position
        function insertLoremIpsum(dummyText) {
            const activeEditor = getActiveEditor();
            if (activeEditor) {
                const wrappedText = dummyText.replace(/(.{80})/g, "$1\n"); // Wrap every 80 characters
                const cursor = activeEditor.getCursor();
                activeEditor.replaceRange(wrappedText, cursor);
                activeEditor.focus(); // Focus back on the editor
            }
        }

        // Function to get the active editor
        function getActiveEditor() {
            const htmlEditorElement = htmlEditor.getWrapperElement();
            const cssEditorElement = cssEditor.getWrapperElement();
            const jsEditorElement = jsEditor.getWrapperElement();

            if (!htmlEditorElement.classList.contains('hidden')) {
                return htmlEditor;
            } else if (!cssEditorElement.classList.contains('hidden')) {
                return cssEditor;
            } else if (!jsEditorElement.classList.contains('hidden')) {
                return jsEditor;
            }
            return null;
        }

        // Undo/Redo Functions
        function undo() {
            const activeEditor = getActiveEditor();
            if (activeEditor) {
                activeEditor.undo();
                updateUndoRedoButtons(); // Update button states after undo
            }
        }

        function redo() {
            const activeEditor = getActiveEditor();
            if (activeEditor) {
                activeEditor.redo();
                updateUndoRedoButtons(); // Update button states after undo
            }
        }

        function zoomIn() {
            document.body.style.zoom = (parseFloat(document.body.style.zoom || 1) + 0.1).toFixed(1);
        }

        function zoomOut() {
            document.body.style.zoom = (parseFloat(document.body.style.zoom || 1) - 0.1).toFixed(1);
        }

        // Function to update undo/redo button states
        function updateUndoRedoButtons(event) {
            const activeEditor = getActiveEditor();
            if (activeEditor) {
                const undoButton = document.getElementById('undo-button');
                const redoButton = document.getElementById('redo-button');
                const history = activeEditor.historySize();
                undoButton.disabled = !history.undo;
                redoButton.disabled = !history.redo;
                checkCapsLock();
            }
        }

        function checkCapsLock() {
            document.addEventListener('keydown', function (event) {
                if (event.getModifierState("CapsLock")) {
                    showCapsLockWarning();
                } else {
                    hideCapsLockWarning();
                }
            });

            document.addEventListener('keyup', function (event) {
                if (!event.getModifierState("CapsLock")) {
                    hideCapsLockWarning();
                }
            });
        }

        function showCapsLockWarning() {
            let warning = document.getElementById("capsWarning");
            if (!warning) {
                warning = document.createElement("div");
                warning.id = "capsWarning";
                warning.innerHTML = "‚ö†Ô∏è Caps Lock is ON!";
                warning.style.position = "fixed";
                warning.style.top = "10px";
                warning.style.right = "10px";
                warning.style.color = "red";
                warning.style.background = "yellow";
                warning.style.padding = "10px";
                warning.style.border = "2px solid red";
                warning.style.borderRadius = "5px";
                warning.style.animation = "blink 0.3s infinite alternate";
                document.body.appendChild(warning);
            }
            warning.style.display = "block";
        }

        function hideCapsLockWarning() {
            const warning = document.getElementById("capsWarning");
            if (warning) {
                warning.style.display = "none";
            }
        }

        // Listen for changes in editors to update undo/redo buttons
        htmlEditor.on('change', updateUndoRedoButtons);
        cssEditor.on('change', updateUndoRedoButtons);
        jsEditor.on('change', updateUndoRedoButtons);

        // Show HTML editor by default
        toggleFile('html');

        // Initialize preview with default content
        updatePreview();

        // Chat Window Functions
        function toggleChat() {
            const chatWindow = document.querySelector('.chat-window');
            chatWindow.style.display = chatWindow.style.display === 'flex' ? 'none' : 'flex';
        }

        function showFAQs() {
            const chatBody = document.getElementById('chat-body');
            chatBody.innerHTML = `
        <div class="message bot">
            <p>Here are some FAQs:</p>
        </div>
        <div class="action-buttons">
            <button onclick="selectFAQ('How do I add an image?')">How do I add an image?</button>
            <button onclick="selectFAQ('How do I style my page?')">How do I style my page?</button>
            <button onclick="selectFAQ('How do I add JavaScript?')">How do I add JavaScript?</button>
        </div>
    `;
        }

        function selectFAQ(faq) {
            const chatBody = document.getElementById('chat-body');
            chatBody.innerHTML += `
        <div class="message user">
            <p>${faq}</p>
        </div>
    `;
            // Simulate a bot response
            setTimeout(() => {
                chatBody.innerHTML += `
            <div class="message bot">
                <p>This is a response to: "${faq}".</p>
            </div>
        `;
                chatBody.scrollTop = chatBody.scrollHeight;
            }, 1000);
        }

        function showCustomMessageInput() {
            const chatFooter = document.getElementById('chat-footer');
            chatFooter.style.display = 'flex';
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            // Add user message to chat
            const chatBody = document.getElementById('chat-body');
            chatBody.innerHTML += `
        <div class="message user">
            <p>${message}</p>
        </div>
    `;

            // Clear input
            input.value = '';

            // Scroll to bottom
            chatBody.scrollTop = chatBody.scrollHeight;

            // Send message to API (mock API for demonstration)
            const response = await mockApiCall(message);

            // Add bot response to chat
            chatBody.innerHTML += `
        <div class="message bot">
            <p>${response}</p>
        </div>
    `;

            // Scroll to bottom
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        // Mock API call (replace with actual API call)
        async function mockApiCall(message) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve(`You said: "${message}". This is a mock response.`);
                }, 1000);
            });
        }

        // Toggle Preview Layout
        function togglePreviewLayout() {
            const mainContainer = document.getElementById('main-container');
            const previewToggleButton = document.getElementById('preview-toggle-button');

            if (mainContainer.classList.contains('preview-right')) {
                mainContainer.classList.remove('preview-right');
                mainContainer.classList.add('preview-bottom');
            } else {
                mainContainer.classList.remove('preview-bottom');
                mainContainer.classList.add('preview-right');
            }
        }

        // Function to select all text in the active editor
        function selectAll() {
            const activeEditor = getActiveEditor();
            if (activeEditor) {
                activeEditor.execCommand('selectAll');
            }
        }

        // Function to copy selected text in the active editor
        function copyText() {
            const activeEditor = getActiveEditor();
            if (activeEditor) {
                const selectedText = activeEditor.getSelection();
                if (selectedText) {
                    navigator.clipboard.writeText(selectedText).then(() => {
                        console.log('Text copied to clipboard');
                    }).catch(err => {
                        console.error('Failed to copy text: ', err);
                    });
                }
            }
        }

        // Function to paste text into the active editor
        function pasteText() {
            const activeEditor = getActiveEditor();
            if (activeEditor) {
                navigator.clipboard.readText().then(text => {
                    const cursor = activeEditor.getCursor();
                    activeEditor.replaceRange(text, cursor);
                });
            }
        }

        // Function to clear the active editor
        function clearEditor() {
            const activeEditor = getActiveEditor();
            if (activeEditor) {
                activeEditor.setValue('');
            }
        }

        // Function to toggle the visibility of the special character buttons
        function toggleSpecialChars() {
            const specialCharsButtons = document.getElementById('special-char-buttons');
            specialCharsButtons.style.display = specialCharsButtons.style.display === 'flex' ? 'none' : 'flex';
        }

        // Function to toggle autocomplete
        function toggleAutocomplete() {
            const autocompleteButton = document.getElementById('autocomplete-button');
            const editor = getActiveEditor();

            if (autocompleteButton.textContent.includes('On')) {
                autocompleteButton.textContent = 'üí°: ‚ùåOff';
                editor.setOption('hintOptions', { completeSingle: false });
            } else {
                autocompleteButton.textContent = 'üí°: ‚úÖOn';
                editor.setOption('hintOptions', { completeSingle: true });
            }
            editor.focus();
        }

        function prettifyCode() {
            const activeEditor = getActiveEditor();
            if (activeEditor) {
                let code = activeEditor.getValue();
                let beautifiedCode;
                if (activeEditor.getMode().name === "htmlmixed") {
                    beautifiedCode = html_beautify(code, {
                        "wrap_line_length": 120,
                        "indent_size": 4,
                        "preserve_newlines": true,
                        "unformatted": ['pre', 'code', 'textarea']
                    });
                } else if (activeEditor.getMode().name === "css") {
                    beautifiedCode = css_beautify(code, {
                        "indent_size": 4
                    });
                } else if (activeEditor.getMode().name === "javascript") {
                    beautifiedCode = js_beautify(code, {
                        "indent_size": 4
                    });
                }
                if (beautifiedCode) {
                    activeEditor.setValue(beautifiedCode);
                } else {
                    alert("The selected editor does not support code formatting.");
                }
            }
        }

        // Function to save the content of the active editor to a file
        function saveFile() {
            const activeEditor = getActiveEditor();
            if (!activeEditor) {
                alert('No active editor to save.');
                return;
            }

            const content = activeEditor.getValue();
            const fileName = prompt('Enter file name:', 'code.txt');
            if (!fileName) {
                alert('File save cancelled.');
                return;
            }

            // Create a Blob (Binary Large Object) with the content
            const blob = new Blob([content], { type: 'text/plain' });

            // Create a URL for the Blob
            const url = URL.createObjectURL(blob);

            // Create a link element to trigger the download
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName; // Set the file name
            a.style.display = 'none'; // Hide the link

            // Append the link to the body, trigger the download, and remove the link
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url); // Clean up the URL object
            alert(`File "${fileName}" saved successfully.`);
        }
    </script>
</body>
</html>
